# etcd模块关系


## raft协议


```


etcd是对raft的一个具体实现，虽然调整了一些特殊逻辑，但是整体是raft的实现

raft重要的功能
- leader选举
- 日志复制
- 网络分区后选举
- 日志压缩和快照



```


## 具体模块


```

1. http/grpc服务模块

对外提供api接口，支持http和grpc协议访问etcd服务

2. Raft 模块

用于实现分布式一致性算法。在 etcd 集群中，多个节点通过 Raft 协议来保证数据的一致性。Raft 模块负责处理选举、日志复制、成员变更等操作

3. KV 存储模块

主要负责存储键值对

4. Watch 模块

允许客户端监视键值对的变化



```


## 模块关系

```

http/grpc服务模块是入口，根据外部请求，访问不同模块

raft模块为kv模块写提供一致性保障，当有新的键值对写入 KV 存储时，KV 存储模块会将写操作请求传递给 Raft 模块，通过 Raft 协议在集群节点间进行日志复制和状态机应用，确保所有节点的 KV 存储最终一致。而 KV 存储模块中的数据读取操作则可以在本地节点直接进行，不需要经过 Raft 模块（在数据是最新的情况下）

Watch 与 KV 存储和 Raft：Watch 模块依赖 KV 存储模块来获取键值对的初始状态，并在之后依赖 Raft 模块来获取键值对的变更信息。当 Raft 模块完成日志复制导致 KV 存储发生变化时，会通知 Watch 模块，Watch 模块再将变更信息发送给相应的客户端


```

## 源码分析顺序


```

从server入口开始，查看接口都如何调用到其他模块

逐步分析其他模块的实现：raft、kv、watch等


```